# Agent 開発ガイド

このガイドでは、新しいエージェントの作成方法と既存エージェントのカスタマイズ方法を説明します。

## 目次

1. [エージェントとは](#エージェントとは)
2. [エージェントの構造](#エージェントの構造)
3. [新しいエージェントの作成](#新しいエージェントの作成)
4. [ベストプラクティス](#ベストプラクティス)
5. [テストとデバッグ](#テストとデバッグ)

## エージェントとは

エージェントは、特定のタスクや問題領域に特化したAIアシスタントです。Claude Code / Claude Agent SDKを使用して、プログラミング支援を行います。

### このリポジトリのエージェントの特徴

- **ドメイン特化**: C#/C++開発に特化
- **タスク志向**: メモリ安全性、相互運用、ビルドなど特定の課題に焦点
- **実用的**: 実際の開発フローに統合可能

## エージェントの構造

各エージェントは以下の構造を持ちます：

```
agents/agent-name/
├── README.md              # エージェントの説明
├── prompts/               # プロンプトテンプレート
│   ├── system.md         # システムプロンプト
│   └── examples/         # 使用例
├── tools/                 # カスタムツール（オプション）
├── tests/                 # テストケース
└── config.json           # 設定ファイル（オプション）
```

### README.md

エージェントの目的、機能、使用方法を記述します。

**必須セクション:**
- 概要
- 主な機能
- 使用方法
- 技術スタック

### prompts/

エージェントが使用するプロンプトを格納します。

#### system.md
エージェントの振る舞いを定義するシステムプロンプト。

```markdown
# Memory Safety Analyzer

あなたはC++のメモリ安全性を専門とするエキスパートです。

## 役割

コードレビュー時に以下を検出・提案します：
- メモリリーク
- ダングリングポインタ
- バッファオーバーフロー
- RAII違反

## アプローチ

1. コードを静的解析
2. 潜在的な問題を特定
3. 具体的な修正案を提示
4. ベストプラクティスを説明

...
```

#### examples/
使用例とテストケースを格納します。

## 新しいエージェントの作成

### ステップ1: 要件定義

1. **目的の明確化**: 何を解決するか？
2. **対象ユーザー**: どんな開発者が使うか？
3. **入力/出力**: 何を受け取り、何を返すか？
4. **成功基準**: どうなれば成功か？

### ステップ2: ディレクトリ作成

```bash
mkdir -p agents/your-agent-name/{prompts/examples,tools,tests}
cd agents/your-agent-name
```

### ステップ3: README作成

```markdown
# Your Agent Name

## 概要
[エージェントの説明]

## 主な機能
- 機能1
- 機能2

## 使用方法
[使い方の説明]

## 技術スタック
[使用する技術]
```

### ステップ4: システムプロンプト作成

`prompts/system.md` を作成し、エージェントの振る舞いを定義します。

**プロンプト設計のポイント:**

1. **役割の明確化**: エージェントが何の専門家かを明記
2. **制約条件**: 何をすべきで、何をすべきでないか
3. **出力フォーマット**: どのような形式で結果を返すか
4. **例示**: 具体的な入出力例を含める

```markdown
# [Agent Name]

あなたは[専門分野]の専門家です。

## 役割
[エージェントの役割]

## タスク
ユーザーから[入力]を受け取り、以下を行います：
1. [ステップ1]
2. [ステップ2]
3. [ステップ3]

## 出力形式
```
[出力フォーマットの例]
```

## 制約
- [制約1]
- [制約2]
```

### ステップ5: 例示の作成

`prompts/examples/` に使用例を作成します。

```markdown
# Example 1: [タイトル]

## 入力
```cpp
// 問題のあるコード
```

## 期待される出力
```cpp
// 修正されたコード
```

## 説明
[なぜこの修正が必要か]
```

### ステップ6: テストケース作成

`tests/` にテストケースを作成します。

```markdown
# Test Case 1: [テスト名]

## 目的
[何をテストするか]

## 入力
[テスト入力]

## 期待結果
[期待される出力]

## 検証方法
[どう検証するか]
```

### ステップ7: 動作確認

Claude Code / Claude Agent SDK を使って実際に動かしてみます。

```bash
# エージェントをテスト
claude-code --agent agents/your-agent-name
```

## ベストプラクティス

### プロンプト設計

✅ **良い例:**
- 具体的で明確な指示
- 豊富な例示
- 構造化された出力形式
- 境界条件の明記

❌ **悪い例:**
- 曖昧な指示
- 例示なし
- 自由形式の出力
- エッジケースの考慮なし

### コード例の品質

- **実用的**: 実際のコードに近いもの
- **段階的**: 簡単なものから複雑なものへ
- **説明的**: なぜそうするのかを明記
- **ベストプラクティス**: 推奨される書き方を示す

### ドキュメント

- **包括的**: すべての機能を文書化
- **最新**: コードと同期を保つ
- **例示豊富**: 使い方がすぐわかる
- **トラブルシューティング**: よくある問題と解決策

## エージェントのカスタマイズ

### 既存エージェントの拡張

1. エージェントのディレクトリに移動
2. `prompts/system.md` を編集
3. 新しい例を `prompts/examples/` に追加
4. テストして動作確認

### パラメータの調整

`config.json` (オプション) でエージェントの動作を調整できます：

```json
{
  "name": "memory-safety-analyzer",
  "version": "1.0.0",
  "description": "C++ memory safety analyzer",
  "parameters": {
    "strictness": "high",
    "suggest_alternatives": true,
    "include_explanations": true
  }
}
```

## テストとデバッグ

### ユニットテスト

各テストケースに対して：

1. 入力を用意
2. エージェントを実行
3. 出力を検証
4. 期待通りか確認

### 統合テスト

実際のプロジェクトで使用して：

1. 実コードに適用
2. 結果の妥当性確認
3. パフォーマンス測定
4. フィードバック収集

### デバッグ

問題が発生した場合：

1. **プロンプトを確認**: 指示が明確か？
2. **例示を追加**: 似たケースの例があるか？
3. **制約を調整**: 制約が強すぎ/弱すぎないか？
4. **段階的に**: 簡単なケースから試す

## エージェント開発のワークフロー

```
1. 要件定義
   ↓
2. プロトタイプ作成
   ↓
3. 例示の充実
   ↓
4. テスト
   ↓
5. ドキュメント作成
   ↓
6. レビュー・改善
   ↓
7. リリース
```

## チェックリスト

新しいエージェントを作成する際のチェックリスト：

- [ ] README.md が完成している
- [ ] システムプロンプトが明確
- [ ] 少なくとも3つの例示がある
- [ ] テストケースがある
- [ ] 実際のコードで動作確認済み
- [ ] ドキュメントが最新
- [ ] ベストプラクティスに従っている

## 参考リソース

- Claude Code 公式ドキュメント
- Claude Agent SDK ガイド
- プロンプトエンジニアリングのベストプラクティス

## 次のステップ

1. [セットアップガイド](setup.md) でエージェントの実行環境を構築
2. 既存のエージェントのコードを参考にする
3. 自分のニーズに合わせてカスタマイズ
4. 新しいエージェントを作成

---

**質問やフィードバックがあれば、Issue を作成してください！**
